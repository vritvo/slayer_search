<style>
.lx-highlight { position: relative; border-radius:3px; padding:1px 2px;}
.lx-highlight .lx-tooltip {
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
  background: #333;
  color: #fff;
  text-align: left;
  border-radius: 4px;
  padding: 6px 8px;
  position: absolute;
  z-index: 1000;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  max-width: 240px;
  white-space: normal;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.lx-highlight:hover .lx-tooltip { visibility: visible; opacity:1; }
.lx-animated-wrapper { max-width: 100%; font-family: Arial, sans-serif; }
.lx-controls {
  background: #fafafa; border: 1px solid #90caf9; border-radius: 8px;
  padding: 12px; margin-bottom: 16px;
}
.lx-button-row {
  display: flex; justify-content: center; gap: 8px; margin-bottom: 12px;
}
.lx-control-btn {
  background: #4285f4; color: white; border: none; border-radius: 4px;
  padding: 8px 16px; cursor: pointer; font-size: 13px; font-weight: 500;
  transition: background-color 0.2s;
}
.lx-control-btn:hover { background: #3367d6; }
.lx-progress-container {
  margin-bottom: 8px;
}
.lx-progress-slider {
  width: 100%; margin: 0; appearance: none; height: 6px;
  background: #ddd; border-radius: 3px; outline: none;
}
.lx-progress-slider::-webkit-slider-thumb {
  appearance: none; width: 18px; height: 18px; background: #4285f4;
  border-radius: 50%; cursor: pointer;
}
.lx-progress-slider::-moz-range-thumb {
  width: 18px; height: 18px; background: #4285f4; border-radius: 50%;
  cursor: pointer; border: none;
}
.lx-status-text {
  text-align: center; font-size: 12px; color: #666; margin-top: 4px;
}
.lx-text-window {
  font-family: monospace; white-space: pre-wrap; border: 1px solid #90caf9;
  padding: 12px; max-height: 260px; overflow-y: auto; margin-bottom: 12px;
  line-height: 1.6;
}
.lx-attributes-panel {
  background: #fafafa; border: 1px solid #90caf9; border-radius: 6px;
  padding: 8px 10px; margin-top: 8px; font-size: 13px;
}
.lx-current-highlight {
  border-bottom: 4px solid #ff4444;
  font-weight: bold;
  animation: lx-pulse 1s ease-in-out;
}
@keyframes lx-pulse {
  0% { text-decoration-color: #ff4444; }
  50% { text-decoration-color: #ff0000; }
  100% { text-decoration-color: #ff4444; }
}
.lx-legend {
  font-size: 12px; margin-bottom: 8px;
  padding-bottom: 8px; border-bottom: 1px solid #e0e0e0;
}
.lx-label {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 3px;
  margin-right: 4px;
  color: #000;
}
.lx-attr-key {
  font-weight: 600;
  color: #1565c0;
  letter-spacing: 0.3px;
}
.lx-attr-value {
  font-weight: 400;
  opacity: 0.85;
  letter-spacing: 0.2px;
}

/* Add optimizations with larger fonts and better readability for GIFs */
.lx-gif-optimized .lx-text-window { font-size: 16px; line-height: 1.8; }
.lx-gif-optimized .lx-attributes-panel { font-size: 15px; }
.lx-gif-optimized .lx-current-highlight { text-decoration-thickness: 4px; }
</style>
    <div class="lx-animated-wrapper lx-gif-optimized">
      <div class="lx-attributes-panel">
        <div class="lx-legend">Highlights Legend: <span class="lx-label" style="background-color:#D2E3FC;">location</span></div>
        <div id="attributesContainer"></div>
      </div>
      <div class="lx-text-window" id="textWindow">

    Cut to <span class="lx-highlight lx-current-highlight" data-idx="0" style="background-color:#D2E3FC;">the library</span>. Willow has the city plans on the computer monitor.

BUFFY
There it is.

WILLOW
That runs under the graveyard.

XANDER
I don&#x27;t see any access.

GILES
So, all the city plans are just, uh, open to the public?

WILLOW
Um, well, i-in a way. I sort of stumbled onto them when I accidentally decrypted the city council&#x27;s security system.

XANDER
Someone&#x27;s been naughty.

BUFFY
There&#x27;s nothing here, this is useless!

GILES
I think you&#x27;re being a bit hard on yourself.

BUFFY
You&#x27;re the one that told me that I wasn&#x27;t prepared enough. Understatement! (exhales) I thought I was on top of everything, and then that monster, Luke, came out of nowhere...

She flashes back to the fight in the mausoleum.

XANDER
What?

BUFFY
He didn&#x27;t come out of nowhere. He came from behind me. I was facing the entrance, he came from behind me, and he didn&#x27;t follow me out. The access to the tunnels is in the mausoleum! The girl must have doubled back with Jesse after I got out! God! I am so mentally challenged!

XANDER
So, what&#x27;s the plan? We saddle up, right?

BUFFY
There&#x27;s no &#x27;we&#x27;, okay? I&#x27;m the Slayer, and you&#x27;re not.

XANDER
I knew you&#x27;d throw that back in my face.

BUFFY
Xander, this is deeply dangerous.

XANDER
I&#x27;m inadequate. That&#x27;s fine. I&#x27;m less than a man.

WILLOW
Buffy, I&#x27;m not anxious to go into a dark place full of monsters. But I do want to help. I need to.

GILES
Well, then help me. I&#x27;ve been researching this Harvest affair. It seems to be some sort of preordained massacre. Rivers of blood, Hell on Earth, quite charmless. I&#x27;m a bit fuzzy, however, on the details. It may be that you can wrest some information from that dread machine.

Everyone stares at him. He looks back at them all.

GILES
That was a bit, um, British, wasn&#x27;t it?

BUFFY
(smiles) Welcome to the New World.

GILES
(to Willow) I want you to go on the &#x27;Net.

WILLOW
Oh, sure, I can do that. (begins to type)

BUFFY
Then I&#x27;m outta here. If Jesse&#x27;s alive, I&#x27;ll bring him back. (starts to leave)

GILES
Do I have to tell you to be careful?

Buffy turns back, gives Giles a look and goes. 


      </div>
      <div class="lx-controls">
        <div class="lx-button-row">
          <button class="lx-control-btn" onclick="playPause()">▶️ Play</button>
          <button class="lx-control-btn" onclick="prevExtraction()">⏮ Previous</button>
          <button class="lx-control-btn" onclick="nextExtraction()">⏭ Next</button>
        </div>
        <div class="lx-progress-container">
          <input type="range" id="progressSlider" class="lx-progress-slider"
                 min="0" max="0" value="0"
                 onchange="jumpToExtraction(this.value)">
        </div>
        <div class="lx-status-text">
          Entity <span id="entityInfo">1/1</span> |
          Pos <span id="posInfo">[12-23]</span>
        </div>
      </div>
    </div>

    <script>
      (function() {
        const extractions = [{"index": 0, "class": "location", "text": "the library", "color": "#D2E3FC", "startPos": 12, "endPos": 23, "beforeText": "\n    Cut to ", "extractionText": "the library", "afterText": ". Willow has the city plans on the computer monitor.\n\nBUFFY\nThere it is.\n\nWILLOW\nThat runs under the graveyard.\n\nXANDER\nI don&#x27;t see any access.\n\nGILES", "attributesHtml": "<div><strong>class:</strong> location</div><div><strong>attributes:</strong> {<span class=\"lx-attr-key\">location_descr</span>: <span class=\"lx-attr-value\">Inside the library with city plans on a computer monitor</span>}</div>"}];
        let currentIndex = 0;
        let isPlaying = false;
        let animationInterval = null;
        let animationSpeed = 1.0;

        function updateDisplay() {
          const extraction = extractions[currentIndex];
          if (!extraction) return;

          document.getElementById('attributesContainer').innerHTML = extraction.attributesHtml;
          document.getElementById('entityInfo').textContent = (currentIndex + 1) + '/' + extractions.length;
          document.getElementById('posInfo').textContent = '[' + extraction.startPos + '-' + extraction.endPos + ']';
          document.getElementById('progressSlider').value = currentIndex;

          const playBtn = document.querySelector('.lx-control-btn');
          if (playBtn) playBtn.textContent = isPlaying ? '⏸ Pause' : '▶️ Play';

          const prevHighlight = document.querySelector('.lx-text-window .lx-current-highlight');
          if (prevHighlight) prevHighlight.classList.remove('lx-current-highlight');
          const currentSpan = document.querySelector('.lx-text-window span[data-idx="' + currentIndex + '"]');
          if (currentSpan) {
            currentSpan.classList.add('lx-current-highlight');
            currentSpan.scrollIntoView({block: 'center', behavior: 'smooth'});
          }
        }

        function nextExtraction() {
          currentIndex = (currentIndex + 1) % extractions.length;
          updateDisplay();
        }

        function prevExtraction() {
          currentIndex = (currentIndex - 1 + extractions.length) % extractions.length;
          updateDisplay();
        }

        function jumpToExtraction(index) {
          currentIndex = parseInt(index);
          updateDisplay();
        }

        function playPause() {
          if (isPlaying) {
            clearInterval(animationInterval);
            isPlaying = false;
          } else {
            animationInterval = setInterval(nextExtraction, animationSpeed * 1000);
            isPlaying = true;
          }
          updateDisplay();
        }

        window.playPause = playPause;
        window.nextExtraction = nextExtraction;
        window.prevExtraction = prevExtraction;
        window.jumpToExtraction = jumpToExtraction;

        updateDisplay();
      })();
    </script>